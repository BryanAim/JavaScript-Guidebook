(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{223:function(t,a,e){t.exports=e.p+"assets/img/fffa7afc-2fa1-464b-9d7d-05bdade58ce1.336ee4bf.png"},672:function(t,a,e){"use strict";e.r(a);var s=e(0),r=Object(s.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"http-身份验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http-身份验证"}},[t._v("#")]),t._v(" HTTP 身份验证")]),t._v(" "),s("p",[t._v("HTTP 提供一个用于权限控制和认证的通用框架。最常用的 HTTP 认证方案是 HTTP Basic authentication。本页介绍了通用的 HTTP 认证框架以及展示如何通过 HTTP Basic authentication 来限制权限访问您的服务器。")]),t._v(" "),s("h2",{attrs:{id:"basic-认证实例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#basic-认证实例"}},[t._v("#")]),t._v(" Basic 认证实例")]),t._v(" "),s("p",[t._v("下面通过实例来讲解 Basic 认证是如何实现的，一共分 4 个步骤。假设：")]),t._v(" "),s("ol",[s("li",[t._v("用户访问的资源："),s("code",[t._v("/protected_docs")])]),t._v(" "),s("li",[t._v("用户名、密码："),s("code",[t._v("chyingp")]),t._v("、"),s("code",[t._v("123456")])])]),t._v(" "),s("h3",{attrs:{id:"步骤-1：用户访问受限资源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#步骤-1：用户访问受限资源"}},[t._v("#")]),t._v(" 步骤 1：用户访问受限资源")]),t._v(" "),s("p",[t._v("如下，用户访问受限资源 "),s("code",[t._v("/protected_docs")]),t._v("。请求报文如下：")]),t._v(" "),s("div",{staticClass:"language-http extra-class"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[s("span",{pre:!0,attrs:{class:"token request-line"}},[s("span",{pre:!0,attrs:{class:"token property"}},[t._v("GET")]),t._v(" /protected_docs HTTP/1.1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Host:")]),t._v(" 127.0.0.1:3000\n")])])]),s("h3",{attrs:{id:"步骤-2：服务端返回-401-要求身份认证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#步骤-2：服务端返回-401-要求身份认证"}},[t._v("#")]),t._v(" 步骤 2：服务端返回 401 要求身份认证")]),t._v(" "),s("p",[t._v("服务端发现 "),s("code",[t._v("/protected_docs")]),t._v(" 为受限资源，于是向用户发送 401 状态码，要求进行身份认证。")]),t._v(" "),s("div",{staticClass:"language-http extra-class"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[s("span",{pre:!0,attrs:{class:"token response-status"}},[t._v("HTTP/1.1 "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("401 Unauthorized")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("WWW-Authenticate:")]),t._v(" Basic realm=protected_docs\n")])])]),s("p",[t._v("响应首部中，通过"),s("code",[t._v("WWW-Authenticate")]),t._v("告知客户端，认证的方案是"),s("code",[t._v("basic")]),t._v("。同时以"),s("code",[t._v("realm")]),t._v("告知认证的范围。")]),t._v(" "),s("div",{staticClass:"language-http extra-class"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("WWW-Authenticate:")]),t._v(" Basic realm=<需要保护资源的范围>\n")])])]),s("h3",{attrs:{id:"步骤-3：用户发送认证请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#步骤-3：用户发送认证请求"}},[t._v("#")]),t._v(" 步骤 3：用户发送认证请求")]),t._v(" "),s("p",[t._v("用户收到服务端响应后，填写用户名、密码，然后向服务端发送认证请求。")]),t._v(" "),s("p",[s("img",{attrs:{src:e(223),alt:"用户发送认证请求"}})]),t._v(" "),s("p",[t._v("以下为请求报文。"),s("code",[t._v("Authorization")]),t._v("请求首部中，包含了用户填写的用户名、密码。")]),t._v(" "),s("div",{staticClass:"language-http extra-class"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[s("span",{pre:!0,attrs:{class:"token request-line"}},[s("span",{pre:!0,attrs:{class:"token property"}},[t._v("GET")]),t._v(" /protected_docs HTTP/1.1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Authorization:")]),t._v(" Basic Y2h5aW5ncDoxMjM0NTY=\n")])])]),s("p",[s("code",[t._v("Authorization")]),t._v("首部的格式为"),s("code",[t._v("Basic base64(userid:password)")]),t._v("。实际代码如下：")]),t._v(" "),s("div",{staticClass:"language-http extra-class"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[t._v("Buffer.from('chyingp:123456').toString('base64'); // Y2h5aW5ncDoxMjM0NTY=\n")])])]),s("h3",{attrs:{id:"步骤-4：服务端验证请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#步骤-4：服务端验证请求"}},[t._v("#")]),t._v(" 步骤 4：服务端验证请求")]),t._v(" "),s("p",[t._v("服务端收到用户的认证请求后，对请求进行验证。验证包含如下步骤：")]),t._v(" "),s("ol",[s("li",[t._v("根据用户请求资源的地址，确定资源对应的 realm。")]),t._v(" "),s("li",[t._v("解析 Authorization 请求首部，获得用户名、密码。")]),t._v(" "),s("li",[t._v("判断用户是否有访问该 realm 的权限。")]),t._v(" "),s("li",[t._v("验证用户名、密码是否匹配。")])]),t._v(" "),s("p",[t._v("一旦上述验证通过，则返回请求资源。如果验证失败，则返回 401 要求重新认证，或者返回 403（Forbidden）。")]),t._v(" "),s("h2",{attrs:{id:"安全缺陷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安全缺陷"}},[t._v("#")]),t._v(" 安全缺陷")]),t._v(" "),s("p",[t._v("Basic 认证的安全缺陷比较明显，它通过明文传输用户的密码，这会导致严重的安全问题。")]),t._v(" "),s("ol",[s("li",[t._v("在传输层未加密的情况下，用户明文密码可被中间人截获")]),t._v(" "),s("li",[t._v("明文密码一旦泄露，如果用户其他站点用了同样的明文密码（大概率），那么用户其他站点的安全防线也告破。")])]),t._v(" "),s("p",[t._v("关于上述问题的建议：")]),t._v(" "),s("ol",[s("li",[t._v("传输层未加密的情况下，不要使用 Basic 认证。")]),t._v(" "),s("li",[t._v("如果使用 Basic 认证，登录密码由服务端生成。")]),t._v(" "),s("li",[t._v("如果可能，不要使用 Basic 认证。")])]),t._v(" "),s("blockquote",[s("p",[t._v("除了安全缺陷，Basic 认证还存在无法吊销认证的情况。")])]),t._v(" "),s("h2",{attrs:{id:"身份验证和实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#身份验证和实践"}},[t._v("#")]),t._v(" 身份验证和实践")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://juejin.im/entry/5a586a716fb9a01ca871e714",target:"_blank",rel:"noopener noreferrer"}},[t._v("基于 Token 的身份验证和实践"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("HTTP Basic 提供的身份验证策略缺陷比较明显，当代应用较多使用 Token 的方式进行用户身份验证。")]),t._v(" "),s("p",[t._v("使用基于 Token 的身份验证方法，在服务端不需要存储用户的登录记录。大概的流程是这样的：")]),t._v(" "),s("ol",[s("li",[t._v("客户端使用用户名跟密码请求登录")]),t._v(" "),s("li",[t._v("服务端收到请求，去验证用户名与密码")]),t._v(" "),s("li",[t._v("验证成功后，服务端会签发一个 Token，再把这个 Token 发送给客户端")]),t._v(" "),s("li",[t._v("客户端收到 Token 以后可以把它存储起来，比如放在 Cookie 里或者 Local Storage 里")]),t._v(" "),s("li",[t._v("客户端每次向服务端请求资源的时候需要带着服务端签发的 Token")]),t._v(" "),s("li",[t._v("服务端收到请求，然后去验证客户端请求里面带着的 Token，如果验证成功，就向客户端返回请求的数据")])]),t._v(" "),s("hr"),t._v(" "),s("p",[s("strong",[t._v("参考资料：")])]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Authentication",target:"_blank",rel:"noopener noreferrer"}},[t._v("MDN HTTP Authentication"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://juejin.im/entry/5ac175baf265da239e4e3999",target:"_blank",rel:"noopener noreferrer"}},[t._v("一文读懂 HTTP Basic 身份认证"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);