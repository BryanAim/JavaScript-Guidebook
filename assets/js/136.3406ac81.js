(window.webpackJsonp=window.webpackJsonp||[]).push([[136],{678:function(_,e,v){"use strict";v.r(e);var t=v(0),a=Object(t.a)({},(function(){var _=this,e=_.$createElement,v=_._self._c||e;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("h1",{attrs:{id:"跨域资源共享"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#跨域资源共享"}},[_._v("#")]),_._v(" 跨域资源共享")]),_._v(" "),v("p",[_._v("跨域资源共享（CORS：Cross-Origin Resource Sharing）是一种机制，它使用额外的 HTTP 头来告诉浏览器，让运行在相同域（Origin）上的 Web 应用被准许访问来自不同源服务器上的指定的资源（也即是 "),v("router-link",{attrs:{to:"/computer-networks/frontend-security/same-origin-policy.html"}},[_._v("同源策略")]),_._v(" 的 HTTP 解决方案）。当一个资源从与该资源本身所在的服务器"),v("strong",[_._v("不同的域、协议或端口")]),_._v("请求一个资源时，资源会发起一个"),v("strong",[_._v("跨域 HTTP 请求")]),_._v("。")],1),_._v(" "),v("p",[_._v("CORS 机制是为了在认可用户发起的请求的同时，阻止恶意注入脚本；并在以下情况发起的 HTTP 请求时触发：")]),_._v(" "),v("ul",[v("li",[_._v("不同的域：比如从 "),v("code",[_._v("example.com")]),_._v(" 调用 "),v("code",[_._v("api.com")])]),_._v(" "),v("li",[_._v("不同的子域：比如从 "),v("code",[_._v("example.com")]),_._v(" 调用 "),v("code",[_._v("api.example.com")])]),_._v(" "),v("li",[_._v("不同的端口：比如从 "),v("code",[_._v("example.com")]),_._v(" 调用 "),v("code",[_._v("example.com:3001")])]),_._v(" "),v("li",[_._v("不同的协议：比如从 "),v("code",[_._v("https://example.com")]),_._v(" 调用 "),v("code",[_._v("http://example.com")])])]),_._v(" "),v("h2",{attrs:{id:"实现条件"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#实现条件"}},[_._v("#")]),_._v(" 实现条件")]),_._v(" "),v("p",[_._v("浏览器将 CORS 请求分成两类：简单请求（simple request）和非简单请求（not-so-simple request）。")]),_._v(" "),v("h3",{attrs:{id:"简单请求"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#简单请求"}},[_._v("#")]),_._v(" 简单请求")]),_._v(" "),v("p",[_._v("只要满足以下两大条件，就属于简单请求：")]),_._v(" "),v("p",[_._v("请求方法是以下三种方法之一")]),_._v(" "),v("ul",[v("li",[_._v("HEAD")]),_._v(" "),v("li",[_._v("GET")]),_._v(" "),v("li",[_._v("POST")])]),_._v(" "),v("p",[_._v("HTTP 的首部字段不超出以下几种字段")]),_._v(" "),v("ul",[v("li",[_._v("Accept")]),_._v(" "),v("li",[_._v("Accept-Language")]),_._v(" "),v("li",[_._v("Content-Language")]),_._v(" "),v("li",[_._v("Last-Event-ID")]),_._v(" "),v("li",[_._v("Content-Type\n"),v("ul",[v("li",[v("code",[_._v("application/x-www-form-urlencoded")])]),_._v(" "),v("li",[v("code",[_._v("multipart/form-data")])]),_._v(" "),v("li",[v("code",[_._v("text/plain")])])])])]),_._v(" "),v("h3",{attrs:{id:"非简单请求"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#非简单请求"}},[_._v("#")]),_._v(" 非简单请求")]),_._v(" "),v("p",[_._v("非简单请求需要满足使用以下任意方法的条件：")]),_._v(" "),v("ul",[v("li",[_._v("PUT")]),_._v(" "),v("li",[_._v("DELETE")]),_._v(" "),v("li",[_._v("CONNECT")]),_._v(" "),v("li",[_._v("OPTIONS")]),_._v(" "),v("li",[_._v("TRACE")]),_._v(" "),v("li",[_._v("PATCH")])]),_._v(" "),v("p",[_._v("设置了对 CORS 安全的首部字段集合之外的其他首部字段。")]),_._v(" "),v("ul",[v("li",[_._v("Accept")]),_._v(" "),v("li",[_._v("Accept-Language")]),_._v(" "),v("li",[_._v("Content-Language")]),_._v(" "),v("li",[_._v("Content-Type")]),_._v(" "),v("li",[_._v("DPR")]),_._v(" "),v("li",[_._v("Downlink")]),_._v(" "),v("li",[_._v("Save-Data")]),_._v(" "),v("li",[_._v("Viewport-Width")]),_._v(" "),v("li",[_._v("Width")])]),_._v(" "),v("p",[_._v("Content-Type 的值不属于下列之一：")]),_._v(" "),v("ul",[v("li",[_._v("application/x-www-form-urlencoded")]),_._v(" "),v("li",[_._v("multipart/form-data")]),_._v(" "),v("li",[_._v("text/plain")])]),_._v(" "),v("h4",{attrs:{id:"预请求"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#预请求"}},[_._v("#")]),_._v(" 预请求")]),_._v(" "),v("p",[_._v("预请求是 OPTIONS 请求，浏览器会自动添加 Access-Control-Allow-Headers 和 Access-Control-Allow-Methods")]),_._v(" "),v("p",[_._v("需要服务端返回的响应头 Access-Control-Allow-Headers、Access-Control-Allow-Methods 和 Access-Control-Allow-Origin。")]),_._v(" "),v("p",[_._v("除了 Access-Control-Allow-Origin 是必须的之外，其他两种只有在不符合简单请求需要的时候服务器才需要添加，比如在简单请求的基础上自定义了一个请求头 "),v("code",[_._v("X-xx-name: chris")]),_._v("，那么服务器只需要在响应头中添加 Access-Control-Allow-Headers。每种响应头都可以使用 "),v("code",[_._v("*")]),_._v(" 通配符来表示所有。")]),_._v(" "),v("h4",{attrs:{id:"正常请求"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#正常请求"}},[_._v("#")]),_._v(" 正常请求")]),_._v(" "),v("p",[_._v("预请求完之后就可以发送正常请求了，正常请求的步骤与简单请求一致，也需要添加 Access-Control-Allow-Origin 响应头。")]),_._v(" "),v("h4",{attrs:{id:"减少预请求次数"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#减少预请求次数"}},[_._v("#")]),_._v(" 减少预请求次数")]),_._v(" "),v("p",[_._v("可以通过设置 Access-Control-Max-Aage 来减少预请求的次数，需要包含在预请求的响应头中，指定在该时间内预请求验证有效，不必每次都进行预请求，它的单位是 "),v("code",[_._v("s")]),_._v("。如 "),v("code",[_._v("Access-Control-Max-Age: 1728000")]),_._v("，即有效期为 20 天。")]),_._v(" "),v("h2",{attrs:{id:"其他限制"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#其他限制"}},[_._v("#")]),_._v(" 其他限制")]),_._v(" "),v("ul",[v("li",[_._v("请求头限制")]),_._v(" "),v("li",[_._v("XMLHttpRequestUpload 对象均没有注册任何事件监听器")]),_._v(" "),v("li",[_._v("请求中没有使用 ReadableStream 对象")])]),_._v(" "),v("h2",{attrs:{id:"使用场景"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#使用场景"}},[_._v("#")]),_._v(" 使用场景")]),_._v(" "),v("p",[_._v("跨域资源共享标准（Cross-Origin Sharing Standard）允许在下列场景中使用跨域 HTTP 请求：")]),_._v(" "),v("ul",[v("li",[_._v("前文提到的由 XMLHttpRequest 或 Fetch 发起的跨域 HTTP 请求")]),_._v(" "),v("li",[_._v("Web 字体（CSS 通过 "),v("code",[_._v("@font-face")]),_._v(" 使用跨域字体资源）")]),_._v(" "),v("li",[_._v("WebGL 贴图")]),_._v(" "),v("li",[_._v("使用 "),v("code",[_._v("drawImage")]),_._v(" 将 "),v("code",[_._v("Images/viedo")]),_._v(" 画面绘制到 Canvas")]),_._v(" "),v("li",[_._v("样式表（使用 CSSOM ）")])]),_._v(" "),v("blockquote",[v("p",[_._v("⚠️注意：HTML 中 "),v("code",[_._v("<link>")]),_._v("、"),v("code",[_._v("<script>")]),_._v("、"),v("code",[_._v("<img>")]),_._v(" 等标签自带连接属性进行 HTTP 请求是能够无视同源策略的。")])]),_._v(" "),v("hr"),_._v(" "),v("p",[v("strong",[_._v("参考资料：")])]),_._v(" "),v("ul",[v("li",[v("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS",target:"_blank",rel:"noopener noreferrer"}},[_._v("MDN HTTP Access control CORS"),v("OutboundLink")],1)]),_._v(" "),v("li",[v("a",{attrs:{href:"https://juejin.im/post/5a97b5a3f265da23766ab19a",target:"_blank",rel:"noopener noreferrer"}},[_._v("理解 CORS"),v("OutboundLink")],1)]),_._v(" "),v("li",[v("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2016/04/cors.html",target:"_blank",rel:"noopener noreferrer"}},[_._v("阮一峰 跨域资源共享 CORS 详解"),v("OutboundLink")],1)]),_._v(" "),v("li",[v("a",{attrs:{href:"https://juejin.im/post/58f816198d6d81005874fd97",target:"_blank",rel:"noopener noreferrer"}},[_._v("由同源策略到前端跨域"),v("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=a.exports}}]);